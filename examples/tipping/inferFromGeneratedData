#!/bin/bash

# This script learns from data files generated by the tool
# Those data files must be in examples/tipping/data/generatedData/
# in a subdirectory specified by second argument ($2) of this script.
# The files must be called simulation0.csv, simulation1.csv and so on
# and the total number of files is specified as thrid argument ($3) of
# this script. The first argument ($1) specifies where to save the results

FULLPATH="examples/tipping/results/$1"
ROUNDS=$2
FILES_NO=$3
UPPER_BOUND=$(( FILES_NO - 1 ))

echo "Writing to $FULLPATH" | tee $FULLPATH

i=0
until [ $i -gt $UPPER_BOUND ]
do
  dataFile="generated/$ROUNDS/simulation$i.csv"
  echo "Inferring from $dataFile..." | tee -a $FULLPATH
  webppl examples/tipping/src/predicting.wppl --require . --require examples/tipping/ --require webppl-fs -- --data $dataFile >> $FULLPATH

  ((i++))
done
echo "Done"